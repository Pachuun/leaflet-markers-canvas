!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(require("core-js/modules/es.array.for-each.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/web.dom-collections.for-each.js"),require("core-js/modules/es.regexp.exec.js"),require("core-js/modules/es.string.search.js"),require("core-js/modules/es.date.to-string.js"),require("core-js/modules/es.regexp.to-string.js"),require("core-js/modules/es.array.iterator.js"),require("core-js/modules/es.array-buffer.slice.js"),require("core-js/modules/es.typed-array.uint32-array.js"),require("core-js/modules/es.typed-array.copy-within.js"),require("core-js/modules/es.typed-array.every.js"),require("core-js/modules/es.typed-array.fill.js"),require("core-js/modules/es.typed-array.filter.js"),require("core-js/modules/es.typed-array.find.js"),require("core-js/modules/es.typed-array.find-index.js"),require("core-js/modules/es.typed-array.for-each.js"),require("core-js/modules/es.typed-array.includes.js"),require("core-js/modules/es.typed-array.index-of.js"),require("core-js/modules/es.typed-array.iterator.js"),require("core-js/modules/es.typed-array.join.js"),require("core-js/modules/es.typed-array.last-index-of.js"),require("core-js/modules/es.typed-array.map.js"),require("core-js/modules/es.typed-array.reduce.js"),require("core-js/modules/es.typed-array.reduce-right.js"),require("core-js/modules/es.typed-array.reverse.js"),require("core-js/modules/es.typed-array.set.js"),require("core-js/modules/es.typed-array.slice.js"),require("core-js/modules/es.typed-array.some.js"),require("core-js/modules/es.typed-array.sort.js"),require("core-js/modules/es.typed-array.subarray.js"),require("core-js/modules/es.typed-array.to-locale-string.js"),require("core-js/modules/es.typed-array.to-string.js"),require("leaflet"),require("rbush"),require("core-js/modules/es.promise.js"),require("core-js/modules/es.function.name.js"),require("core-js/modules/es.array.concat.js")):"function"==typeof define&&define.amd?define(["core-js/modules/es.array.for-each.js","core-js/modules/es.object.to-string.js","core-js/modules/web.dom-collections.for-each.js","core-js/modules/es.regexp.exec.js","core-js/modules/es.string.search.js","core-js/modules/es.date.to-string.js","core-js/modules/es.regexp.to-string.js","core-js/modules/es.array.iterator.js","core-js/modules/es.array-buffer.slice.js","core-js/modules/es.typed-array.uint32-array.js","core-js/modules/es.typed-array.copy-within.js","core-js/modules/es.typed-array.every.js","core-js/modules/es.typed-array.fill.js","core-js/modules/es.typed-array.filter.js","core-js/modules/es.typed-array.find.js","core-js/modules/es.typed-array.find-index.js","core-js/modules/es.typed-array.for-each.js","core-js/modules/es.typed-array.includes.js","core-js/modules/es.typed-array.index-of.js","core-js/modules/es.typed-array.iterator.js","core-js/modules/es.typed-array.join.js","core-js/modules/es.typed-array.last-index-of.js","core-js/modules/es.typed-array.map.js","core-js/modules/es.typed-array.reduce.js","core-js/modules/es.typed-array.reduce-right.js","core-js/modules/es.typed-array.reverse.js","core-js/modules/es.typed-array.set.js","core-js/modules/es.typed-array.slice.js","core-js/modules/es.typed-array.some.js","core-js/modules/es.typed-array.sort.js","core-js/modules/es.typed-array.subarray.js","core-js/modules/es.typed-array.to-locale-string.js","core-js/modules/es.typed-array.to-string.js","leaflet","rbush","core-js/modules/es.promise.js","core-js/modules/es.function.name.js","core-js/modules/es.array.concat.js"],r):r(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(e="undefined"!=typeof globalThis?globalThis:e||self).L,e.RBush)}(this,function(e,r,t,o,s,n,i,a,c,u,l,d,h,m,f,y,p,v,j,g,_,x,w,k,L,b,q,E,T,O,M,B,P,S,z){"use strict";function Y(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var A=Y(S),C=Y(z);function X(){X=function(){return i};var i={},e=Object.prototype,c=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",t=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function n(e,r,t){return Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[r]}try{n({},"")}catch(e){n=function(e,r,t){return e[r]=t}}function a(e,r,t,o){var s,n,i,a,r=r&&r.prototype instanceof d?r:d,r=Object.create(r.prototype),o=new _(o||[]);return r._invoke=(s=e,n=t,i=o,a="suspendedStart",function(e,r){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===e)throw r;return w()}for(i.method=e,i.arg=r;;){var t=i.delegate;if(t){var o=function e(r,t){var o=r.iterator[t.method];if(void 0===o){if(t.delegate=null,"throw"===t.method){if(r.iterator.return&&(t.method="return",t.arg=void 0,e(r,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}o=u(o,r.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,l;var o=o.arg;return o?o.done?(t[r.resultName]=o.value,t.next=r.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}(t,i);if(o){if(o===l)continue;return o}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===a)throw a="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);a="executing";o=u(s,n,i);if("normal"===o.type){if(a=i.done?"completed":"suspendedYield",o.arg===l)continue;return{value:o.arg,done:i.done}}"throw"===o.type&&(a="completed",i.method="throw",i.arg=o.arg)}}),r}function u(e,r,t){try{return{type:"normal",arg:e.call(r,t)}}catch(e){return{type:"throw",arg:e}}}i.wrap=a;var l={};function d(){}function h(){}function m(){}var f={};n(f,o,function(){return this});r=Object.getPrototypeOf,r=r&&r(r(x([])));r&&r!==e&&c.call(r,o)&&(f=r);var y=m.prototype=d.prototype=Object.create(f);function p(e){["next","throw","return"].forEach(function(r){n(e,r,function(e){return this._invoke(r,e)})})}function v(i,a){var r;this._invoke=function(t,o){function e(){return new a(function(e,r){!function r(e,t,o,s){e=u(i[e],i,t);if("throw"!==e.type){var n=e.arg,t=n.value;return t&&"object"==typeof t&&c.call(t,"__await")?a.resolve(t.__await).then(function(e){r("next",e,o,s)},function(e){r("throw",e,o,s)}):a.resolve(t).then(function(e){n.value=e,o(n)},function(e){return r("throw",e,o,s)})}s(e.arg)}(t,o,e,r)})}return r=r?r.then(e,e):e()}}function j(e){var r={tryLoc:e[0]};1 in e&&(r.catchLoc=e[1]),2 in e&&(r.finallyLoc=e[2],r.afterLoc=e[3]),this.tryEntries.push(r)}function g(e){var r=e.completion||{};r.type="normal",delete r.arg,e.completion=r}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(j,this),this.reset(!0)}function x(r){if(r){var e=r[o];if(e)return e.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length)){var t=-1,e=function e(){for(;++t<r.length;)if(c.call(r,t))return e.value=r[t],e.done=!1,e;return e.value=void 0,e.done=!0,e};return e.next=e}}return{next:w}}function w(){return{value:void 0,done:!0}}return n(y,"constructor",h.prototype=m),n(m,"constructor",h),h.displayName=n(m,s,"GeneratorFunction"),i.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},i.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,n(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},i.awrap=function(e){return{__await:e}},p(v.prototype),n(v.prototype,t,function(){return this}),i.AsyncIterator=v,i.async=function(e,r,t,o,s){void 0===s&&(s=Promise);var n=new v(a(e,r,t,o),s);return i.isGeneratorFunction(r)?n:n.next().then(function(e){return e.done?e.value:n.next()})},p(y),n(y,s,"Generator"),n(y,o,function(){return this}),n(y,"toString",function(){return"[object Generator]"}),i.keys=function(t){var e,o=[];for(e in t)o.push(e);return o.reverse(),function e(){for(;o.length;){var r=o.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},i.values=x,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(g),!e)for(var r in this)"t"===r.charAt(0)&&c.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var o=this;function e(e,r){return n.type="throw",n.arg=t,o.next=e,r&&(o.method="next",o.arg=void 0),!!r}for(var r=this.tryEntries.length-1;0<=r;--r){var s=this.tryEntries[r],n=s.completion;if("root"===s.tryLoc)return e("end");if(s.tryLoc<=this.prev){var i=c.call(s,"catchLoc"),a=c.call(s,"finallyLoc");if(i&&a){if(this.prev<s.catchLoc)return e(s.catchLoc,!0);if(this.prev<s.finallyLoc)return e(s.finallyLoc)}else if(i){if(this.prev<s.catchLoc)return e(s.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return e(s.finallyLoc)}}}},abrupt:function(e,r){for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t];if(o.tryLoc<=this.prev&&c.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var s=o;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=r&&r<=s.finallyLoc&&(s=null);var n=s?s.completion:{};return n.type=e,n.arg=r,s?(this.method="next",this.next=s.finallyLoc,l):this.complete(n)},complete:function(e,r){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&r&&(this.next=r),l},finish:function(e){for(var r=this.tryEntries.length-1;0<=r;--r){var t=this.tryEntries[r];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),g(t),l}},catch:function(e){for(var r=this.tryEntries.length-1;0<=r;--r){var t=this.tryEntries[r];if(t.tryLoc===e){var o,s=t.completion;return"throw"===s.type&&(o=s.arg,g(t)),o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,t){return this.delegate={iterator:x(e),resultName:r,nextLoc:t},"next"===this.method&&(this.arg=void 0),l}},i}function I(e,r,t,o,s,n,i){try{var a=e[n](i),c=a.value}catch(e){return void t(e)}a.done?r(c):Promise.resolve(c).then(o,s)}function N(e){function r(e){for(var r,t=window.getComputedStyle(e),o={},s=0;s<t.length;s++)o[t[s]]=t.getPropertyValue(t[s]);for(r in o)e.style[r]=o[r];return o}r(e),e.querySelectorAll("*").forEach(r)}var U=function(){var a,t=(a=X().mark(function e(r,n){var t,i,o,a,s,c=arguments;return X().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=(s=2<c.length&&void 0!==c[2]?c[2]:{}).scale,t=void 0===o?1:o,o=s.format,i=void 0===o?"png":o,o=s.quality,o=void 0===o?.92:o,s=s.download,a=void 0===s||s,(s=document.createElement("template")).innerHTML=r,N(s),e.next=6,function(e){var r=e.template,t=e.scale,o=e.format,s=e.quality,e=(new XMLSerializer).serializeToString(r),n=document.createElement("canvas"),r=r.getBoundingClientRect();n.width=r.width*t,n.height=r.height*t,n.style.width=r.width,n.style.height=r.height;var i=n.getContext("2d");i.scale(t,t);var a=document.createElement("img");return a.setAttribute("src","data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e)))),new Promise(function(r){a.onload=function(){i.drawImage(a,0,0);var e=n.toDataURL("image/".concat(o),o="png",s);r(e)}})}({template:s,scale:t,format:i,quality:o}).then(function(e){var r,t,o,s;return a&&(t=(r={file:e,name:n,format:i}).file,o=r.name,s=r.format,(r=document.createElement("a")).className="display-none",r.download="".concat(o,".").concat(s),r.href=t,document.body.appendChild(r),r.click()),e}).catch(console.error);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e)}),function(){var e=this,i=arguments;return new Promise(function(r,t){var o=a.apply(e,i);function s(e){I(o,r,t,s,n,"next",e)}function n(e){I(o,r,t,s,n,"throw",e)}s(void 0)})});return function(e,r){return t.apply(this,arguments)}}(),z={_map:null,_canvas:null,_context:null,_markers:[],_markersTree:new C.default,_positionsTree:new C.default,_icons:{},addTo:function(e){return e.addLayer(this),this},getBounds:function(){var r=new A.default.LatLngBounds;return this._markers.forEach(function(e){r.extend(e.getLatLng())}),r},redraw:function(){this._redraw(!0)},clear:function(){this._positionsTree=new C.default,this._markersTree=new C.default,this._markers=[],this._redraw(!0)},addMarker:function(e){var r=this._addMarker(e),t=r.markerBox,e=r.positionBox,r=r.isVisible;t&&r&&this._markersTree.insert(t),e&&this._positionsTree.insert(e)},addMarkers:function(e){var o=this,s=[],n=[];e.forEach(function(e){var r=o._addMarker(e),t=r.markerBox,e=r.positionBox,r=r.isVisible;t&&r&&s.push(t),e&&n.push(e)}),this._markersTree.load(s),this._positionsTree.load(n)},removeMarker:function(e){var r=e.getLatLng(),t=this._map.getBounds().contains(r),e={minX:r.lng,minY:r.lat,maxX:r.lng,maxY:r.lat,marker:e};this._positionsTree.remove(e,function(e,r){return e.marker._leaflet_id===r.marker._leaflet_id}),t&&this._redraw(!0)},removeMarkers:function(e){var o=this,s=!1;e.forEach(function(e){var r=e.getLatLng(),t=o._map.getBounds().contains(r),e={minX:r.lng,minY:r.lat,maxX:r.lng,maxY:r.lat,marker:e};o._positionsTree.remove(e,function(e,r){return e.marker._leaflet_id===r.marker._leaflet_id}),t&&(s=!0)}),s&&this._redraw(!0)},initialize:function(e){A.default.Util.setOptions(this,e)},onAdd:function(e){this._map=e,this._initCanvas(),this.getPane().appendChild(this._canvas),e.on("moveend",this._reset,this),e.on("resize",this._reset,this),e.on("click",this._fire,this),e.on("mousemove",this._fire,this),e._zoomAnimated&&e.on("zoomanim",this._animateZoom,this)},onRemove:function(e){this.getPane().removeChild(this._canvas),e.off("click",this._fire,this),e.off("mousemove",this._fire,this),e.off("moveend",this._reset,this),e.off("resize",this._reset,this),e._zoomAnimated&&e.off("zoomanim",this._animateZoom,this)},setOptions:function(e){return A.default.Util.setOptions(this,e),this.redraw()},registerImage:function(e,r){this._icons[e]={image:r,isLoaded:!0}},convert:function(e,r,t){return U(e,r,t)},_initCanvas:function(){var e=this._map.getSize(),r=e.x,t=e.y,e=this._map.options.zoomAnimation&&A.default.Browser.any3d;this._canvas=A.default.DomUtil.create("canvas","leaflet-markers-canvas-layer leaflet-layer"),this._canvas.width=r,this._canvas.height=t,this._context=this._canvas.getContext("2d"),A.default.DomUtil.addClass(this._canvas,"leaflet-zoom-".concat(e?"animated":"hide"))},_addMarker:function(e){if("markerPane"!==e.options.pane||!e.options.icon)return console.error("This is not a marker",e),{markerBox:null,positionBox:null,isVisible:null};e._map=this._map,A.default.Util.stamp(e);var r=e.getLatLng(),t=this._map.getBounds().contains(r),o=this._map.latLngToContainerPoint(r),s=o.x,n=o.y,i=e.options.icon.options,o=i.iconSize,i=i.iconAnchor,i={minX:s-i[0],minY:n-i[1],maxX:s+o[0]-i[0],maxY:n+o[1]-i[1],marker:e},r={minX:r.lng,minY:r.lat,maxX:r.lng,maxY:r.lat,marker:e};return t&&this._drawMarker(e,{x:s,y:n}),this._markers.push(e),{markerBox:i,positionBox:r,isVisible:t}},_drawMarker:function(e,r){var o=this,t=r.x,s=r.y,n=e.options.icon.options,i=n.iconUrl,a=n.html;n.iconAnchor,n.iconSize;r=void 0;a&&(r=this.hash(a)),e.image?this._drawImage(e,{x:t,y:s}):i?this._icons[i]?(e.image=this._icons[i].image,this._icons[i].isLoaded?this._drawImage(e,{x:t,y:s}):this._icons[i].elements.push({marker:e,x:t,y:s})):((n=new Image).src=i,e.image=n,this._icons[i]={image:n,isLoaded:!1,elements:[{marker:e,x:t,y:s}]},n.onload=function(){o._icons[i].isLoaded=!0,o._icons[i].elements.forEach(function(e){var r=e.marker,t=e.x,e=e.y;o._drawImage(r,{x:t,y:e})})}):r&&(this._icons[r]?(e.image=this._icons[i].image,this._icons[r].isLoaded?this._drawImage(e,{x:t,y:s}):this._icons[r].elements.push({marker:e,x:t,y:s})):U(a))},_drawImage:function(e,r){var t=r.x,o=r.y,s=e.options.icon.options,n=s.rotationAngle,r=s.iconAnchor,s=s.iconSize,n=n||0;this._context.save(),this._context.translate(t,o),this._context.rotate(n*Math.PI/180),this._context.drawImage(e.image,-r[0],-r[1],s[0],s[1]),this._context.restore()},_redraw:function(e){var n,i=this;e&&this._context.clearRect(0,0,this._canvas.width,this._canvas.height),this._map&&this._positionsTree&&(e={minX:(e=this._map.getBounds()).getWest(),minY:e.getSouth(),maxX:e.getEast(),maxY:e.getNorth()},n=[],this._positionsTree.search(e).forEach(function(e){var r=e.marker,t=r.getLatLng(),o=i._map.latLngToContainerPoint(t),s=o.x,e=o.y,t=r.options.icon.options,o=t.iconSize,t=t.iconAnchor,t={minX:s-t[0],minY:e-t[1],maxX:s+o[0]-t[0],maxY:e+o[1]-t[1],marker:r};n.push(t),i._drawMarker(r,{x:s,y:e})}),this._markersTree.clear(),this._markersTree.load(n))},_reset:function(){var e=this._map.containerPointToLayerPoint([0,0]);A.default.DomUtil.setPosition(this._canvas,e);var r=this._map.getSize(),e=r.x,r=r.y;this._canvas.width=e,this._canvas.height=r,this._redraw()},_fire:function(e){var r,t;this._markersTree&&(r=(t=e.containerPoint).x,t=t.y,(t=this._markersTree.search({minX:r,minY:t,maxX:r,maxY:t}))&&t.length?(this._map._container.style.cursor="pointer",t=t[0].marker,"click"===e.type&&t.listens("click")&&t.fire("click"),"mousemove"===e.type&&(this._mouseOverMarker&&this._mouseOverMarker!==t&&this._mouseOverMarker.listens("mouseout")&&this._mouseOverMarker.fire("mouseout"),this._mouseOverMarker&&this._mouseOverMarker===t||(this._mouseOverMarker=t).listens("mouseover")&&t.fire("mouseover"))):(this._map._container.style.cursor="","mousemove"===e.type&&this._mouseOverMarker&&(this._mouseOverMarker.listens("mouseout")&&this._mouseOverMarker.fire("mouseout"),delete this._mouseOverMarker)))},_animateZoom:function(e){var r=this._map.getZoomScale(e.zoom),e=this._map._latLngBoundsToNewLayerBounds(this._map.getBounds(),e.zoom,e.center).min;A.default.DomUtil.setTransform(this._canvas,e,r)},hash:function(e){for(var r=0,t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r&=r;return new Uint32Array([r])[0].toString(36)}};A.default.MarkersCanvas=A.default.Layer.extend(z)});
